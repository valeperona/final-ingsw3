<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-container" (click)="stopPropagation($event)">
    <!-- Header del modal -->
    <div class="modal-header">
      <h2>
        <span class="ai-icon">‚ú®</span>
        Polo AI Assistant
      </h2>
      <button class="close-btn" (click)="closeModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <!-- Indicador de pasos -->
    <div class="steps-indicator">
      <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
        <div class="step-number">1</div>
        <div class="step-label">Descripci√≥n</div>
      </div>
      <div class="step-line" [class.completed]="currentStep > 1"></div>
      <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
        <div class="step-number">2</div>
        <div class="step-label">Contexto</div>
      </div>
      <div class="step-line" [class.completed]="currentStep > 2"></div>
      <div class="step" [class.active]="currentStep === 3">
        <div class="step-number">3</div>
        <div class="step-label">Resultado</div>
      </div>
    </div>

    <!-- Contenido del modal -->
    <div class="modal-body">
      <!-- Paso 1: Descripci√≥n principal -->
      <div *ngIf="currentStep === 1" class="step-content">
        <div class="question-section">
          <h3>üìù Describe el puesto que est√°s buscando</h3>
          <p class="help-text">
            Cu√©ntanos sobre las responsabilidades, tareas diarias y lo que esperas del empleado ideal.
          </p>

          <div class="form-group">
            <label for="recruiter-description">Descripci√≥n detallada *</label>
            <textarea
              id="recruiter-description"
              [(ngModel)]="recruiterDescription"
              placeholder="Ejemplo: Deber√° encargarse de la coordinaci√≥n y desarrollo de sistemas inform√°ticos en Python, React y PostgreSQL. Tendr√° un equipo a cargo de 3-5 personas. Ser√° responsable de definir arquitectura, revisar c√≥digo, y gestionar sprints."
              rows="8"
              class="form-control"></textarea>
            <small class="form-text">M√≠nimo 50 caracteres</small>
          </div>
        </div>
      </div>

      <!-- Paso 2: Contexto adicional -->
      <div *ngIf="currentStep === 2" class="step-content">
        <div class="question-section">
          <h3>üí° Informaci√≥n adicional (opcional)</h3>
          <p class="help-text">
            Agrega cualquier detalle extra que pueda ayudar a generar una mejor oferta.
          </p>

          <div class="form-group">
            <label for="additional-context">Contexto adicional</label>
            <textarea
              id="additional-context"
              [(ngModel)]="additionalContext"
              placeholder="Ejemplo: Es para el equipo de desarrollo core. Valoramos proactividad y capacidad de liderazgo. Modalidad h√≠brida (3 d√≠as presencial, 2 remoto)."
              rows="6"
              class="form-control"></textarea>
            <small class="form-text">Cultura de empresa, beneficios, detalles del equipo, etc.</small>
          </div>
        </div>
      </div>

      <!-- Paso 3: Resultado generado -->
      <div *ngIf="currentStep === 3 && generatedData" class="step-content">
        <div class="result-section">
          <div class="success-badge">
            <i class="bi bi-check-circle-fill"></i>
            ¬°Oferta generada exitosamente!
          </div>

          <div class="generated-preview">
            <div class="preview-item">
              <strong>T√≠tulo del Puesto:</strong>
              <p>{{ generatedData.title }}</p>
            </div>

            <div class="preview-item">
              <strong>Descripci√≥n:</strong>
              <p>{{ generatedData.description }}</p>
            </div>

            <div class="preview-item">
              <strong>Requisitos:</strong>
              <p>{{ generatedData.requirements }}</p>
            </div>

            <div class="preview-item">
              <strong>Experiencia requerida:</strong>
              <p *ngIf="generatedData.min_experience_years === 0 && !generatedData.max_experience_years">
                Sin experiencia previa
              </p>
              <p *ngIf="generatedData.min_experience_years > 0 && generatedData.max_experience_years">
                {{ generatedData.min_experience_years }} - {{ generatedData.max_experience_years }} a√±os
              </p>
              <p *ngIf="generatedData.min_experience_years > 0 && !generatedData.max_experience_years">
                M√≠nimo {{ generatedData.min_experience_years }} a√±os
              </p>
            </div>

            <div class="preview-item" *ngIf="generatedData.required_skills.length > 0">
              <strong>Habilidades requeridas:</strong>
              <div class="skills-tags">
                <span class="skill-tag required" *ngFor="let skill of generatedData.required_skills">
                  {{ skill }}
                </span>
              </div>
            </div>

            <div class="preview-item" *ngIf="generatedData.nice_to_have_skills.length > 0">
              <strong>Habilidades deseables:</strong>
              <div class="skills-tags">
                <span class="skill-tag optional" *ngFor="let skill of generatedData.nice_to_have_skills">
                  {{ skill }}
                </span>
              </div>
            </div>
          </div>

          <div class="info-note">
            <i class="bi bi-info-circle"></i>
            Los campos se completar√°n en el formulario. Podr√°s editarlos antes de publicar la oferta.
          </div>
        </div>
      </div>

      <!-- Mensaje de error -->
      <div *ngIf="errorMessage" class="error-message">
        <i class="bi bi-exclamation-triangle"></i>
        {{ errorMessage }}
      </div>

      <!-- Mensaje de carga -->
      <div *ngIf="generating" class="loading-section">
        <div class="spinner"></div>
        <p>Generando oferta con IA...</p>
        <small>Esto puede tomar unos segundos</small>
      </div>
    </div>

    <!-- Footer con botones -->
    <div class="modal-footer">
      <!-- Botones para paso 1 -->
      <div *ngIf="currentStep === 1" class="button-group">
        <button class="btn btn-secondary" (click)="closeModal()">
          Cancelar
        </button>
        <button
          class="btn btn-primary"
          (click)="goToNextStep()"
          [disabled]="!recruiterDescription.trim() || recruiterDescription.length < 50">
          Siguiente
          <i class="bi bi-arrow-right"></i>
        </button>
      </div>

      <!-- Botones para paso 2 -->
      <div *ngIf="currentStep === 2" class="button-group">
        <button class="btn btn-secondary" (click)="goToPreviousStep()">
          <i class="bi bi-arrow-left"></i>
          Atr√°s
        </button>
        <button class="btn btn-success" (click)="generateJobPosting()" [disabled]="generating">
          <i class="bi bi-magic"></i>
          Generar con IA
        </button>
      </div>

      <!-- Botones para paso 3 (resultado) -->
      <div *ngIf="currentStep === 3 && generatedData" class="button-group">
        <button class="btn btn-secondary" (click)="resetAndClose()">
          Descartar
        </button>
        <button class="btn btn-success" (click)="applyGeneratedFields()">
          <i class="bi bi-check-lg"></i>
          Aplicar al Formulario
        </button>
      </div>
    </div>
  </div>
</div>
